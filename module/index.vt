<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cleaning</title>

    <link rel="stylesheet" href="styles/bootstrap.css">
    <link rel="stylesheet" href="styles/bootstrap-theme.css">
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="scripts/webservices/web-services.js"></script>

    <style media="screen" type="text/css">
      h1, h2, h3, h4, h5, h6 {
      font-family: 'Corben', Georgia, Times, serif;
    }
    p, div {
      font-family: 'Nobile', Helvetica, Arial, sans-serif;
    }
    body {
      background: url(cream_dust.png) repeat 0 0;
    }
    </style>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'  type='text/css'>
    
    <script type="text/javascript">
      function changeViewToOpenRefine() {
        $('#btn_submit').attr('value', "Start");
        $('#btn_clean').hide(1);
      }

    function changeViewToWebService() {
        $('#btn_submit').attr('value',"Cleaning Suggestions");
        $('#btn_clean').show(1);
    }
    function addMetricesInRequest() { 
        var metrices = [];

        $('input[type=checkbox]').each(function(){ 
            if($(this).is(":checked") && $(this).val() !== '') {
                metrices.push($(this).val());
            }
        });

        if(metrices.length > 0) { 
            $('<input />').attr('type','hidden').attr('value',
            JSON.stringify(metrices, null, 2)).attr('id','metrics').
            attr('name', 'metrics').appendTo('#dataset');
        }
      }
      $(function(){

        $('#metricsTree').hide(1)
        var webServiceView = new WebServiceView();
        var html = webServiceView.buildHtml();
        $('#metricsTree').append(html);

        changeViewToOpenRefine();
    
        $('input[type=radio][name=operation]').change(function(){
            if(this.value === 'openRefine') {
                $('#metricsTree').hide(1000);
                changeViewToOpenRefine();
            } else {
                $('#metricsTree').show(1000);
                changeViewToWebService();
            }
        });

        $('#btn_clean').click(function(){
            addMetricesInRequest();
            form.action = "clean_download";
            form.method = "get";
            form.submit();
        });

        $('#btn_submit').click(function() {
            var url = $('#url_input').val();
            var file = $('#file_input').val();
            if(url == '' && file != '') {
                $('#url_input').attr('name','upload');
            } else if (url == '' && file == '') {
                 $('#url_input').focus();
            } else if (url != '' && file == '') {

            }

            if($("input[name='operation']:checked").val() === 'openRefine') {
                form.action = "open_in_refine"
                form.method = "post"
                form.submit();
            } else {
                addMetricesInRequest();
                form.action = "get_cleaning_suggestions_download";
                form.method = "get";
                form.submit();
            }

        });

        $('input[type=checkbox]').on('change', function(){
            //one of the parent metrics
            if($(this).val() === '') {
                $(this).next().find('input[type=checkbox]').prop('checked',this.checked);
            } else {
                if(!this.checked) {
                    $(this).parent().parent().prev().prop('checked', false);
                } else {
                    var siblings = $(this).parent().siblings();
                    var allSelected = true;
                    for (var i = 0; i < siblings.length; i++) {
                        if(!siblings[i].children[0].checked) {
                            allSelected = false;
                            break;
                        }
                    }
                    $(this).parent().parent().prev().prop('checked', allSelected);
                }
            }
        });
      });
    </script>
  </head>

  <body>
    <div class="container">
      <div class="page-header">
        <img src="diachron-logo.png" align="baseline" style="width: 20%; height: 20%; margin: 0px 10px 0px 0px"/>
        <h2 style="margin: 0px 0px 0px 20px">Cleaning Service</h2>
      </div

      <br/>
      <br/>
      <div>
        <form name="form" enctype="multipart/form-data" id="dataset" class="form-horizontal">
            <fieldset style="width: 50%">
              <legend>Select Dataset</legend>
              <input id="url_input" class="form-control" type="url" name="download" placeholder="Enter URL of the dataset"><br>
              <input id="file_input" type="file" multiple="" bind="fileInput" name="upload">
            </fieldset>
           
           <br/>
           <br/>
           <br/>
           
           <fieldset style="width: 50%">
              <legend>Select Service</legend>
              <input name="operation" type="radio" value="openRefine" checked>Open Refine</input><br/>
              <input name="operation" type="radio" value="webServices">Web Service</input><br/>
              <div id="metricsTree" style="border:1px solid #CFCFCF; margin-top: 10px; padding: 10px 10px 10px 10px;">
                <h4>Quality Metrics</h4>
                <p>Please select quality metrics to analyze or clean data.</p>
              </div>
            </fieldset>
          
          <div id="buttons" style="padding-top: 10px; width: 20%; height: 20%">
            <input type="button" id="btn_submit" class="btn btn-primary btn-block" value="Submit" />
            <input type="button" id="btn_clean"  class="btn btn-primary btn-block" value="Clean" />
          </div>
        </form>
      </div>
    </div>

  </body>
</html>